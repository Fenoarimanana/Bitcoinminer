<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Dashboard - Bitcoin Miner</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            background: radial-gradient(circle at 50% 30%, #ff9900 0%, #222 80%);
            min-height: 100vh;
        }
        .bitcoin-card {
            background: rgba(34, 34, 34, 0.95);
            border: 2px solid #ff9900;
            border-radius: 20px;
            box-shadow: 0 0 30px #ff990055;
            color: #fff;
        }
        .main-balance {
            font-size: 2.2rem;
            font-weight: bold;
            color: #ffb300;
            letter-spacing: 1px;
        }
        .boost-btn {
            background: linear-gradient(90deg, #ff9900 60%, #ffd700 100%);
            color: #222;
            font-weight: bold;
            border: none;
            border-radius: 30px;
            box-shadow: 0 2px 8px #ff990055;
        }
        .boost-btn:hover {
            background: linear-gradient(90deg, #ffd700 60%, #ff9900 100%);
            color: #222;
        }
        .section-title {
            color: #ff9900;
            font-weight: bold;
            margin-bottom: 0.5rem;
        }
        .balance-label {
            color: #ffd700;
            font-size: 1.1rem;
        }
        .withdraw-btn {
            background: transparent;
            border: 2px solid #ff9900;
            color: #ff9900;
            font-weight: bold;
            border-radius: 30px;
            transition: background 0.2s, color 0.2s;
        }
        .withdraw-btn:hover {
            background: #ff9900;
            color: #222;
        }
        .ref-link {
            background: #222;
            color: #ff9900;
            border: 1px solid #ff9900;
            border-radius: 8px;
        }
    </style>
</head>
<body>
<div class="container py-5">
    <div class="text-center mb-4">
        <img src="https://cryptologos.cc/logos/bitcoin-btc-logo.png" alt="Bitcoin" width="60">
        <h2 class="mt-2" style="color:#ff9900;">Dashboard</h2>
        <div style="color:#ffd700;">Welcome, {{ request.user.username }}</div>
    </div>
    <div class="bitcoin-card p-4 mx-auto mb-4" style="max-width: 430px;">
        <div class="section-title mb-2">ðŸ”¨ Live BTC Mining</div>
        <div class="main-balance mb-2">
            BTC <span id="mined-amount">0.0000000001</span>
        </div>
        <!-- <button class="btn boost-btn w-100 mb-3" disabled>âš¡ Boost Miner</button> -->
        <div class="d-flex justify-content-between align-items-center mb-2">
            <span class="balance-label">Mining Speed</span>
            <span id="mining-speed">{{ profile.mining_speed|floatformat:8 }} MH/sec</span>
        </div>
        <div class="d-flex justify-content-between align-items-center mb-3">
            <span class="balance-label">Available balance</span>
            <span>BTC <span id="available-balance">0.0000000001</span></span>
        </div>
        <form action="/withdraw/" method="get">
            <button type="submit" class="btn withdraw-btn w-100 mb-2">Withdraw funds</button>
        </form>
        <form action="/deposit/" method="get">
            <button type="submit" class="btn boost-btn w-100 mb-2">âš¡ Boost Miner</button>
        </form>
        <form action="/logout/" method="get">
            <button type="submit" class="btn btn-dark w-100 border mt-2">Logout</button>
        </form>
    </div>
    <div class="alert alert-info" style="background:#222; color:#ffd700; border:1px solid #ff9900;">
    <b>How the Referral Program Works:</b><br>
    1. Share your referral link below with your friends.<br>
    2. When someone registers using your link and makes a deposit, you will receive a <b>20% bonus</b> based on their deposit amount.<br>
    3. The more people you invite, the more you can earn!<br>
    4. You can track your referrals and bonuses in your dashboard.<br>
<div class="bitcoin-card p-3 mx-auto" style="max-width: 430px;">
    <div class="section-title mb-2">Your Referral Link</div>
    <input type="text" class="form-control ref-link mb-2" value="{{ referral_link }}" readonly>
    <div class="mt-2" style="color:#ffd700;">
        <b>Number of referrals:</b> {{ referral_count }}
    </div>
</div>
<script>
    // Valeur initiale
    const miningSpeed = {{ profile.mining_speed|floatformat:8 }};
    const increment = miningSpeed * 0.000000000001; // Ajuste pour la vitesse dÃ©sirÃ©e
    const decimals = 10;

    // RÃ©cupÃ¨re la derniÃ¨re valeur minÃ©e et la derniÃ¨re date depuis localStorage
    let mined = parseFloat(localStorage.getItem('mined_amount')) || 0.0000000001;
    let lastUpdate = parseInt(localStorage.getItem('last_update')) || Date.now();

    // Calcule le temps Ã©coulÃ© depuis la derniÃ¨re visite
    const now = Date.now();
    const elapsedSeconds = Math.floor((now - lastUpdate) / 2000); // 2 secondes par tick

    // Ajoute le minage "hors ligne"
    if (elapsedSeconds > 0) {
        mined += increment * elapsedSeconds;
    }

    // Affiche la valeur au chargement
    function updateDisplay() {
        document.getElementById('mined-amount').textContent = mined.toFixed(decimals);
        document.getElementById('available-balance').textContent = mined.toFixed(decimals);
    }
    updateDisplay();

    // Animation du minage en live
    setInterval(() => {
        mined += increment;
        updateDisplay();
        localStorage.setItem('mined_amount', mined);
        localStorage.setItem('last_update', Date.now());
    }, 2000);
</script>
</body>
</html>